<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- Prevent, to some degree, the execution of inline JavaScript, as well as blocking all plugin content  -->
		<meta http-equiv="Content-Security-Policy" content="script-src 'none'; object-src 'none'; img-src 'none'; font-src 'none'; media-src 'none'; worker-src 'none'; connect-src 'none'; style-src 'self' ">
		<title>Llamafile’s progress, four months in</title>
		<link rel="icon" href="favicon.png" />
		<link rel="stylesheet" href="/a11y-dark.css">
		<link rel="stylesheet" href="/style.css">
	</head>
	<body>
		<main>
		<a target="_blank" rel="noreferrer" href="https://hacks.mozilla.org/2024/04/llamafiles-progress-four-months-in/">Go to article URL</a>
		<div id="content"><p></p><p><span>When Mozilla’s Innovation group </span><a href="https://hacks.mozilla.org/2023/11/introducing-llamafile/" rel="noreferrer" target="_blank"><span>first launched</span></a><span> the </span><a href="https://github.com/Mozilla-Ocho/llamafile" rel="noreferrer" target="_blank"><span>llamafile project</span></a><span> late last year, we were thrilled by the immediate positive response from open source AI developers. It’s become one of Mozilla’s top three most-favorited repositories on GitHub, attracting a number of contributors, some excellent PRs, and a growing community on our </span><a href="https://discord.gg/YuMNeuKStr" rel="noreferrer" target="_blank"><span>Discord server</span></a><span>.</span></p>
<p>Through it all, lead developer and project visionary <a href="https://github.com/jart" rel="noreferrer" target="_blank">Justine Tunney</a> has remained hard at work on a wide variety of fundamental improvements to the project. Just last night, Justine <a href="https://github.com/Mozilla-Ocho/llamafile/releases/tag/0.8" rel="noreferrer" target="_blank">shipped the v0.8 release of llamafile</a>, which includes not only support for the very latest open models, but also a number of big performance improvements for CPU inference.</p>
<p>As a result of Justine’s work, today llamafile is both the easiest <i>and fastest</i> way to run a wide range of open large language models on your own hardware. See for yourself: with llamafile, you can run Meta’s just-released <a href="https://huggingface.co/jartine/Meta-Llama-3-8B-Instruct-llamafile" rel="noreferrer" target="_blank">LLaMA 3 model</a>–which rivals the very best models available in its size class–on an everyday Macbook.</p>
<p><span>How did we do it? To explain that, let’s take a step back and tell you about everything that’s changed since v0.1.</span></p>
<p><b>tinyBLAS: democratizing GPU support for NVIDIA </b><b><i>and</i></b><b> AMD</b></p>
<p><span>llamafile is built atop the now-legendary </span><a href="https://github.com/ggerganov/llama.cpp" rel="noreferrer" target="_blank"><span>llama.cpp</span></a><span> project. llama.cpp supports GPU-accelerated inference for NVIDIA processors via the cuBLAS linear algebra library, but that requires users to install NVIDIA’s CUDA SDK. We felt uncomfortable with that fact, because it conflicts with our project goal of building a fully open-source and transparent AI stack that anyone can run on commodity hardware. And besides, getting CUDA set up correctly can be a bear on some systems. There had to be a better way.</span></p>
<p><span>With the community’s help (here’s looking at you, </span><a href="https://ahgamut.github.io/" rel="noreferrer" target="_blank"><span>@ahgamut</span></a><span> and </span><a href="https://github.com/mrdomino" rel="noreferrer" target="_blank"><span>@mrdomino</span></a><span>!), we created our own solution: it’s called tinyBLAS, and it’s llamafile’s brand-new and highly efficient linear algebra library. tinyBLAS makes NVIDIA acceleration simple and seamless for llamafile users. On Windows, you don’t even need to install CUDA at all; all you need is the display driver you’ve probably already installed.</span></p>
<p><span>But tinyBLAS is about more than just NVIDIA: it supports AMD GPUs, as well. This is no small feat. While AMD commands a respectable 20% of today’s GPU market, poor software and driver support have historically made them a secondary player in the machine learning space. That’s a shame, given that AMD’s GPUs offer high performance, are price competitive, and are widely available. </span></p>
<p><span>One of llamafile’s goals is to democratize access to open source AI technology, and that means getting AMD a seat at the table. That’s exactly what we’ve done: with llamafile’s tinyBLAS, you can now easily make full use of your AMD GPU to accelerate local inference. And, as with CUDA, if you’re a Windows user you don’t even have to install AMD’s ROCm SDK.</span></p>
<p><span>All of this means that, for many users, llamafile will automatically use your GPU right out of the box, with little to no effort on your part.</span></p>
<p><b>CPU performance gains for faster local AI</b></p>
<p><span>Here at Mozilla, we are keenly interested in the promise of “local AI,” in which AI models and applications run directly on end-user hardware instead of in the cloud. Local AI is exciting because it opens up the possibility of more user control over these systems and greater privacy and security for users.</span></p>
<p><span>But many consumer devices lack the high-end GPUs that are often required for inference tasks. llama.cpp has been a game-changer in this regard because it makes local inference both possible and usably performant on CPUs instead of just GPUs.&nbsp;</span></p>
<p><span>Justine’s recent work on llamafile has now pushed the state of the art even further. As documented in </span><a href="http://justine.lol/matmul/" rel="noreferrer" target="_blank"><span>her detailed blog post</span></a><span> on the subject, by writing 84 new matrix multiplication kernels she was able to increase llamafile’s prompt evaluation performance by an astonishing 10x compared to our previous release. This is a substantial and impactful step forward in the quest to make local AI viable on consumer hardware.</span></p>
<p><span>This work is also a great example of our commitment to the open source AI community. After completing this work we immediately </span><a href="https://github.com/ggerganov/llama.cpp/pull/6414" rel="noreferrer" target="_blank"><span>submitted a PR</span></a><span> to upstream these performance improvements to llama.cpp. This was just the latest of a number of enhancements we’ve contributed back to llama.cpp, a practice we plan to continue.</span></p>
<p><b>Raspberry Pi performance gains</b></p>
<p><span>Speaking of consumer hardware, there are few examples that are both more interesting and more humble than the beloved Raspberry Pi. For a bargain basement price, you get a full-featured computer running Linux with plenty of computing power for typical desktop uses. It’s an impressive package, but historically it hasn’t been considered a viable platform for AI applications.</span></p>
<p><span>Not any more. llamafile has now been optimized for the latest model (the Raspberry Pi 5), and the result is that a number of small LLMs–such as Rocket-3B (</span><a href="https://huggingface.co/jartine/rocket-3B-llamafile/resolve/main/rocket-3b.Q5_K_M.llamafile?download=true" rel="noreferrer" target="_blank"><span>download</span></a><span>), TinyLLaMA-1.5B (</span><a href="https://huggingface.co/jartine/TinyLlama-1.1B-Chat-v1.0-GGUF/resolve/main/TinyLlama-1.1B-Chat-v1.0.Q5_K_M.llamafile?download=true" rel="noreferrer" target="_blank"><span>download</span></a><span>), and Phi-2 (</span><a href="https://huggingface.co/jartine/phi-2-llamafile/resolve/main/phi-2.Q5_K_M.llamafile?download=true" rel="noreferrer" target="_blank"><span>download</span></a><span>)–run at usable speeds on one of the least expensive computers available today. We’ve seen prompt evaluation speeds of </span><a href="https://twitter.com/JustineTunney/status/1776440470152867930" rel="noreferrer" target="_blank"><span>up to 80 tokens/sec</span></a><span> in some cases!</span></p>
<p><b>Keeping up with the latest models</b></p>
<p><span>The pace of progress in the open model space has been </span><a href="https://twitter.com/maximelabonne/status/1779123021480865807" rel="noreferrer" target="_blank"><span>stunningly fast</span></a><span>. Over the past few months, hundreds of models have been released or updated via fine-tuning. Along the way, there has been a clear trend of ever-increasing model performance and ever-smaller model sizes. </span></p>
<p><span>The llama.cpp project has been doing an excellent job of keeping up with all of these new models, frequently rolling-out support for new architectures and model features within days of their release.</span></p>
<p><span>For our part we’ve been keeping llamafile closely synced with llama.cpp so that we can support all the same models. Given the complexity of both projects, this has been no small feat, so we’re lucky to have Justine on the case. </span></p>
<p><span>Today, you can today use the very latest and most capable open models with llamafile thanks to her hard work. For example, we were able to roll-out llamafiles for Meta’s newest LLaMA 3 models–</span><a href="https://huggingface.co/jartine/Meta-Llama-3-8B-Instruct-llamafile" rel="noreferrer" target="_blank"><span>8B-Instruct</span></a><span> and </span><a href="https://huggingface.co/jartine/Meta-Llama-3-70B-Instruct-llamafile" rel="noreferrer" target="_blank"><span>70B-Instruct</span></a><span>–within a day of their release. With yesterday’s 0.8 release, llamafile can also run Grok, Mixtral 8x22B, and Command-R.</span></p>
<p><b>Creating your own llamafiles</b></p>
<p><span>Since the day that llamafile shipped people have wanted to create their own llamafiles. Previously, this required a number of steps, but today you can do it with a single command, e.g.:</span></p>
<p><span><code>llamafile-convert [model.gguf]</code></span></p>
<p><span>In just moments, this will produce a “model.llamafile” file that is ready for immediate use. Our thanks to community member </span><a href="https://github.com/chand1012" rel="noreferrer" target="_blank"><span>@chan1012</span></a><span> for contributing this helpful improvement.</span></p>
<p><span>In a related development, Hugging Face recently added official support for llamafile within their model hub. This means you can now </span><a href="https://huggingface.co/models?library=llamafile&amp;sort=trending" rel="noreferrer" target="_blank"><span>search and filter</span></a><span> Hugging Face specifically for llamafiles created and distributed by other people in the open source community.</span></p>
<p><b>OpenAI-compatible API server</b></p>
<p><span>Since it’s built on top of llama.cpp, llamafile inherits that project’s server component, which provides OpenAI-compatible API endpoints. This enables developers who are building on top of OpenAI to switch to using open models instead. At Mozilla we very much want to support this kind of future: one where open-source AI is a viable alternative to centralized, closed, commercial offerings. </span></p>
<p><span>While open models do not yet fully rival the capabilities of closed models, they’re making rapid progress. We believe that making it easier to pivot existing code over to executing against open models will increase demand and further fuel this progress.</span></p>
<p><span>Over the past few months, we’ve invested effort in extending these endpoints, both to increase functionality and improve compatibility. Today, llamafile can serve as a drop-in replacement for OpenAI in a wide variety of use cases. </span></p>
<p><span>We want to further extend our API server’s capabilities, and we’re eager to hear what developers want and need. What’s holding you back from using open models? What features, capabilities, or tools do you need? </span><a href="https://discord.gg/YTgM42NZEr" rel="noreferrer" target="_blank"><span>Let us know</span></a><span>!</span></p>
<p><b>Integrations with other open source AI projects</b></p>
<p><span>Finally, it’s been a delight to see llamafile adopted by independent developers and integrated into leading open source AI projects (like </span><a href="https://github.com/OpenInterpreter/open-interpreter" rel="noreferrer" target="_blank"><span>Open Interpreter</span></a><span>). Kudos in particular to our own </span><a href="https://github.com/k8si" rel="noreferrer" target="_blank"><span>Kate Silverstein</span></a><span> who landed PRs that add llamafile support to </span><a href="https://github.com/langchain-ai/langchain" rel="noreferrer" target="_blank"><span>LangChain</span></a><span> and </span><a href="https://github.com/run-llama/llama_index" rel="noreferrer" target="_blank"><span>LlamaIndex</span></a><span> (with </span><a href="https://github.com/Significant-Gravitas/AutoGPT" rel="noreferrer" target="_blank"><span>AutoGPT</span></a><span> coming soon).</span></p>
<p><span>If you’re a maintainer or contributor to an open source AI project that you feel would benefit from llamafile integration, </span><a href="https://discord.gg/YTgM42NZEr" rel="noreferrer" target="_blank"><span>let us know how we can help</span></a><span>.</span></p>
<p><b>Join us!</b></p>
<p><span>The llamafile project is just getting started, and it’s also only the first step in a major new initiative on Mozilla’s part to contribute to and participate in the open source AI community. We’ll have more to share about that soon, but for now: I invite you to join us on the llamafile project!</span></p>
<p><span>The best place to connect with both the llamafile team at Mozilla and the overall llamafile community is over at our Discord server, which has </span><a href="https://discord.gg/YuMNeuKStr" rel="noreferrer" target="_blank"><span>a dedicated channel just for llamafile</span></a><span>. And of course, your enhancement requests, issues, and PRs are always welcome over at our </span><a href="https://github.com/Mozilla-Ocho/llamafile" rel="noreferrer" target="_blank"><span>GitHub repo</span></a><span>.</span></p>
<p><span>I hope you’ll join us. The next few months are going to be even more interesting and unexpected than the last, both for llamafile and for open source AI itself.</span></p>
<p>&nbsp;</p>
<p>The post <a href="https://hacks.mozilla.org/2024/04/llamafiles-progress-four-months-in/" rel="noreferrer" target="_blank">Llamafile’s progress, four months in</a> appeared first on <a href="https://hacks.mozilla.org" rel="noreferrer" target="_blank">Mozilla Hacks - the Web developer blog</a>.</p>
<p></p></div>
		<div class="content-meta">
			<time datetime=2024-04-25T15:34:08.000Z>25 April 2024</time>
			<a href="/urls/hacks-mozilla-org-feed">hacks.mozilla.org/feed/</a>
			<div> <a href="/tags/web-platform.html">web-platform</a> |  <a style="font-weight: bold" href="/tags/source.html">source</a></div>
		</div>
	</main>
		<footer>
			<nav>
				<a href="/">Home</a>
				<a href="/tags">Tags</a>
				<a href="/urls">URLs</a>
				<a rel="noreferrer" target="_blank" href="https://github.com/thoughtsunificator/rss-feed-static-generator">Source code</a>
			</nav>
		</footer>
		<script src="/highlight.min.js"></script>
		<script>hljs.highlightAll();</script>
		</body>
</html>